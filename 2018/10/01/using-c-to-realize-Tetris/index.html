<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="c++">
<meta property="og:type" content="article">
<meta property="og:title" content="using c++ to realize Tetris">
<meta property="og:url" content="http://yoursite.com/2018/10/01/using-c-to-realize-Tetris/index.html">
<meta property="og:site_name" content="learncat">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://p4wiqzx0i.bkt.clouddn.com/1513155659728.png">
<meta property="og:updated_time" content="2018-10-01T02:25:09.244Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="using c++ to realize Tetris">
<meta name="twitter:image" content="http://p4wiqzx0i.bkt.clouddn.com/1513155659728.png">






  <link rel="canonical" href="http://yoursite.com/2018/10/01/using-c-to-realize-Tetris/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>using c++ to realize Tetris | learncat</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">learncat</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">
    <a href="/schedule/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />Schedule</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">
      <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />Sitemap</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/using-c-to-realize-Tetris/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kai">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://p4wiqzx0i.bkt.clouddn.com/image4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learncat">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">using c++ to realize Tetris
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-01 10:13:00 / Modified: 10:25:09" itemprop="dateCreated datePublished" datetime="2018-10-01T10:13:00+08:00">2018-10-01</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://p4wiqzx0i.bkt.clouddn.com/1513155659728.png" alt=""></p>
<a id="more"></a>
<p>这两天学习了一下怎么用c++来实现俄罗斯方块，虽然最后的界面很感人，但是在这个过程中还是学到了不少的东西。<br>code：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ncurses.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t=a;</span><br><span class="line">	a = b;</span><br><span class="line">	b = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getrand</span><span class="params">(<span class="keyword">int</span> min, <span class="keyword">int</span> max)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span>(min+rand()%(max-min+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">WINDOW *<span class="title">create_newwin</span><span class="params">(<span class="keyword">int</span> height,<span class="keyword">int</span> width,<span class="keyword">int</span> starty,<span class="keyword">int</span> startx)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destory_win</span><span class="params">(WINDOW *local_win)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> game_win_height=<span class="number">30</span>;	</span><br><span class="line"><span class="keyword">int</span> game_win_width=<span class="number">45</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> hint_win_height=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> hint_win_width=<span class="number">20</span>;</span><br><span class="line">WINDOW * game_win, *hint_win ,*score_win;</span><br><span class="line"><span class="keyword">int</span> key;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Piece</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">int</span> score;</span><br><span class="line">	<span class="keyword">int</span> shape; </span><br><span class="line">	<span class="keyword">int</span> next_shape;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> head_x;		<span class="comment">// 当前方块首个box的位置</span></span><br><span class="line">	<span class="keyword">int</span> head_y;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> size_h;</span><br><span class="line">	<span class="keyword">int</span> size_w;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> next_size_h;</span><br><span class="line">	<span class="keyword">int</span> next_size_w;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> box_shape[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">int</span> next_box_shape[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> box_map[<span class="number">30</span>][<span class="number">45</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> game_over;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set_shape</span><span class="params">(<span class="keyword">int</span> &amp;cshape, <span class="keyword">int</span> box_shape[][<span class="number">4</span>],<span class="keyword">int</span> &amp;size_w, <span class="keyword">int</span> &amp; size_h)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">score_next</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">judge</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isaggin</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">exsqr</span><span class="params">(<span class="keyword">int</span> row)</span></span>;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	initscr();</span><br><span class="line">	<span class="comment">//raw();</span></span><br><span class="line">	cbreak();</span><br><span class="line">	noecho();</span><br><span class="line">	curs_set(<span class="number">0</span>);</span><br><span class="line">	keypad(stdscr,TRUE);</span><br><span class="line"></span><br><span class="line">	refresh();</span><br><span class="line">	</span><br><span class="line">	game_win = create_newwin(game_win_height, game_win_width, <span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	wborder(game_win, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>, <span class="string">'*'</span>);</span><br><span class="line">	wrefresh(game_win);</span><br><span class="line"></span><br><span class="line">	hint_win = create_newwin(hint_win_height, hint_win_width, <span class="number">0</span>, game_win_width+<span class="number">10</span>);</span><br><span class="line">	mvprintw(<span class="number">0</span>, game_win_width+<span class="number">10</span>+<span class="number">2</span>,<span class="string">"%s"</span>,<span class="string">"Next"</span>);</span><br><span class="line">	refresh();</span><br><span class="line"></span><br><span class="line">	score_win = create_newwin(hint_win_height, hint_win_width, <span class="number">20</span>, game_win_width+<span class="number">10</span>);</span><br><span class="line">	mvprintw(<span class="number">20</span>, game_win_width+<span class="number">10</span>+<span class="number">2</span>,<span class="string">"%s"</span>,<span class="string">"Score"</span>);</span><br><span class="line">	refresh();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	Piece* pp = <span class="keyword">new</span> Piece;</span><br><span class="line">	pp-&gt;initial();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pp-&gt;move();</span><br><span class="line">		<span class="keyword">if</span>(pp-&gt;game_over)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	destory_win(game_win);</span><br><span class="line">	destory_win(hint_win);</span><br><span class="line">	destory_win(score_win);</span><br><span class="line">	<span class="keyword">delete</span> pp;</span><br><span class="line">	system(<span class="string">"clear"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> row,col;</span><br><span class="line">	getmaxyx(stdscr,row,col);</span><br><span class="line">	mvprintw(row/<span class="number">2</span>,col/<span class="number">2</span> ,<span class="string">"%s"</span>,<span class="string">"GAMER OVER ! \n "</span>);</span><br><span class="line">	mvprintw(row/<span class="number">2</span>+<span class="number">2</span>,col/<span class="number">2</span><span class="number">-2</span> ,<span class="string">"%s"</span>,<span class="string">"Wait 5s to return tthe erminal ! \n "</span>);</span><br><span class="line">	refresh();</span><br><span class="line"></span><br><span class="line">	sleep(<span class="number">5</span>);</span><br><span class="line">	endwin();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">WINDOW *<span class="title">create_newwin</span><span class="params">(<span class="keyword">int</span> height, <span class="keyword">int</span> width, <span class="keyword">int</span> starty, <span class="keyword">int</span> startx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WINDOW *local_win;</span><br><span class="line">	local_win = newwin(height, width, starty, startx);</span><br><span class="line">	box(local_win,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	wrefresh(local_win);</span><br><span class="line">	<span class="keyword">return</span> local_win;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destory_win</span><span class="params">(WINDOW *local_win)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	wborder(local_win, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>, <span class="string">' '</span>);</span><br><span class="line">	wrefresh(local_win);</span><br><span class="line">	delwin(local_win);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::initial()</span><br><span class="line">&#123;</span><br><span class="line">	score=<span class="number">0</span>;</span><br><span class="line">	game_over=<span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;game_win_height;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;game_win_width;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">0</span> || i==game_win_height<span class="number">-1</span> || j==<span class="number">0</span> || j==game_win_width<span class="number">-1</span>)&#123;</span><br><span class="line">				box_map[i][j]=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				box_map[i][j]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	srand((<span class="keyword">unsigned</span>)time(<span class="number">0</span>));</span><br><span class="line">	shape=getrand(<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">	set_shape(shape,box_shape,size_w,size_h);</span><br><span class="line"></span><br><span class="line">	next_shape=getrand(<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">	set_shape(next_shape,next_box_shape,next_size_w,next_size_h);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">			<span class="keyword">if</span>(next_box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">				mvwaddch(hint_win,(hint_win_height-size_h)/<span class="number">2</span>+i,(hint_win_width-size_w)/<span class="number">2</span>+j,<span class="string">'#'</span>);</span><br><span class="line">				wrefresh(hint_win);</span><br><span class="line">			&#125;</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">	mvwprintw(score_win, hint_win_height/<span class="number">2</span>,hint_win_width/<span class="number">2</span><span class="number">-2</span>,<span class="string">"%d"</span>,score);</span><br><span class="line">	wrefresh(score_win);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::set_shape(<span class="keyword">int</span> &amp;cshape, <span class="keyword">int</span> shape[][<span class="number">4</span>],<span class="keyword">int</span> &amp;size_w,<span class="keyword">int</span> &amp;size_h)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">			shape[i][j]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">switch</span>(cshape)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:				<span class="comment">// "####"</span></span><br><span class="line">			size_h=<span class="number">1</span>;</span><br><span class="line">			size_w=<span class="number">4</span>;	</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">3</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:				<span class="comment">// "#"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// "###"</span></span><br><span class="line">			size_w=<span class="number">3</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:				<span class="comment">// "  #"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// "###"</span></span><br><span class="line">			size_w=<span class="number">3</span>;	</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:				<span class="comment">// " ##"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// "##"</span></span><br><span class="line">			size_w=<span class="number">3</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:				<span class="comment">// "##"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// " ##"</span></span><br><span class="line">			size_w=<span class="number">3</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:				<span class="comment">// "##"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// "##"</span></span><br><span class="line">			size_w=<span class="number">2</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:				<span class="comment">// " #"</span></span><br><span class="line">			size_h=<span class="number">2</span>;		<span class="comment">// "###"</span></span><br><span class="line">			size_w=<span class="number">3</span>;</span><br><span class="line">			shape[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			shape[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	head_x=game_win_width/<span class="number">2</span>;	<span class="comment">// 初始化起始位置</span></span><br><span class="line">	head_y=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(isaggin())    <span class="comment">/* GAME OVER ! */</span></span><br><span class="line">		game_over=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::rotate()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> temp[<span class="number">4</span>][<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> temp_piece[<span class="number">4</span>][<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> i,j,tmp_size_h,tmp_size_w;</span><br><span class="line"></span><br><span class="line">	tmp_size_w=size_w;</span><br><span class="line">	tmp_size_h=size_h;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">			temp_piece[i][j]=box_shape[i][j];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">			temp[j][i]=box_shape[i][j];</span><br><span class="line">	i=size_h;</span><br><span class="line">	size_h=size_w;</span><br><span class="line">	size_w=i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;size_h;i++)</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;size_w;j++)</span><br><span class="line">			box_shape[i][size_w<span class="number">-1</span>-j]=temp[i][j];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(isaggin())&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>;i++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">				box_shape[i][j]=temp_piece[i][j];</span><br><span class="line">		size_w=tmp_size_w;</span><br><span class="line">		size_h=tmp_size_h;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>;i++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(temp_piece[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">					mvwaddch(game_win,head_y+i,head_x+j,<span class="string">' '</span>);</span><br><span class="line">					wrefresh(game_win);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size_h;i++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">					mvwaddch(game_win,head_y+i,head_x+j,<span class="string">'#'</span>);</span><br><span class="line">					wrefresh(game_win);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::move()&#123;</span><br><span class="line">	 fd_set <span class="built_in">set</span>;</span><br><span class="line">	 FD_ZERO(&amp;<span class="built_in">set</span>);</span><br><span class="line">	 FD_SET(<span class="number">0</span>, &amp;<span class="built_in">set</span>);</span><br><span class="line">	      </span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">timeout</span>;</span></span><br><span class="line">	 timeout.tv_sec = <span class="number">0</span>;</span><br><span class="line">	 timeout.tv_usec= <span class="number">500000</span>;		<span class="comment">// timeout设置为最多等待时间，超过这个时间将不再等待getchar</span></span><br><span class="line">	      </span><br><span class="line">  	<span class="keyword">if</span> (select(<span class="number">1</span>, &amp;<span class="built_in">set</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;timeout) == <span class="number">0</span>)&#123;</span><br><span class="line">		head_y++;</span><br><span class="line">		<span class="keyword">if</span>(isaggin())&#123;</span><br><span class="line">			head_y--;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size_h;i++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)</span><br><span class="line">					<span class="keyword">if</span>(box_shape[i][j]==<span class="number">1</span>)</span><br><span class="line">						box_map[head_y+i][head_x+j]=<span class="number">1</span>;</span><br><span class="line">			score_next();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=size_h<span class="number">-1</span>; i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)&#123;</span><br><span class="line">					<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">						mvwaddch(game_win,head_y<span class="number">-1</span>+i,head_x+j,<span class="string">' '</span>);</span><br><span class="line">						mvwaddch(game_win,head_y+i,head_x+j,<span class="string">'#'</span>);</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			wrefresh(game_win);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">  	&#125;</span><br><span class="line">	      </span><br><span class="line">	<span class="keyword">if</span> (FD_ISSET(<span class="number">0</span>, &amp;<span class="built_in">set</span>)) &#123;		<span class="comment">// 如果在规定的时间内检测到按键，得到输入key = getchar();</span></span><br><span class="line">	        <span class="keyword">while</span> ((key = getch()) == <span class="number">-1</span>) ;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(key==KEY_LEFT)&#123;		<span class="comment">// 进行相关的上下左右的移动</span></span><br><span class="line">			head_x--;</span><br><span class="line">			<span class="keyword">if</span>(isaggin())</span><br><span class="line">				head_x++; <span class="comment">//undo</span></span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size_h;i++)</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">							mvwaddch(game_win,head_y+i,head_x+j+<span class="number">1</span>,<span class="string">' '</span>);</span><br><span class="line">							mvwaddch(game_win,head_y+i,head_x+j,<span class="string">'#'</span>);</span><br><span class="line"></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				wrefresh(game_win);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(key==KEY_RIGHT)&#123;</span><br><span class="line">			head_x++;</span><br><span class="line">			<span class="keyword">if</span>(isaggin())</span><br><span class="line">				head_x--;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size_h;i++)</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> j=size_w<span class="number">-1</span>;j&gt;=<span class="number">0</span>;j--)&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">							mvwaddch(game_win,head_y+i,head_x+j<span class="number">-1</span>,<span class="string">' '</span>);</span><br><span class="line">							mvwaddch(game_win,head_y+i,head_x+j,<span class="string">'#'</span>);</span><br><span class="line"></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				wrefresh(game_win);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(key==KEY_DOWN)&#123;</span><br><span class="line">			head_y++;</span><br><span class="line">			<span class="keyword">if</span>(isaggin())&#123;</span><br><span class="line">				head_y--;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size_h;i++)</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)</span><br><span class="line">						<span class="keyword">if</span>(box_shape[i][j]==<span class="number">1</span>)</span><br><span class="line">							box_map[head_y+i][head_x+j]=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">				score_next();</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i=size_h<span class="number">-1</span>; i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">							mvwaddch(game_win,head_y<span class="number">-1</span>+i,head_x+j,<span class="string">' '</span>);</span><br><span class="line">							mvwaddch(game_win,head_y+i,head_x+j,<span class="string">'#'</span>);</span><br><span class="line"></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				wrefresh(game_win);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(key==KEY_UP)</span><br><span class="line">			rotate();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(head_x+size_w+<span class="number">1</span>&gt;game_win_width)</span><br><span class="line">			head_x=game_win_width-size_w<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">if</span>(head_x&lt;<span class="number">1</span>)</span><br><span class="line">			head_x=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Piece::isaggin()&#123;					<span class="comment">// 判断图形是否与边界或其他图形产生冲突。</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size_h;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size_w;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(head_y+i &gt; game_win_height<span class="number">-2</span>)		<span class="comment">// 高</span></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">if</span>(head_x+j &gt; game_win_width<span class="number">-2</span> || head_x+i<span class="number">-1</span>&lt;<span class="number">0</span>)		<span class="comment">// 宽</span></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">if</span>(box_map[head_y+i][head_x+j]==<span class="number">1</span>)		<span class="comment">// 其他图形</span></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">true</span> ;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Piece::exsqr(<span class="keyword">int</span> row)&#123;				<span class="comment">// 检查当前行是否是空行</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;game_win_width<span class="number">-1</span>;j++)</span><br><span class="line">		<span class="keyword">if</span>(box_map[row][j]==<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::judge()&#123;			<span class="comment">// 判断当前行是否已满</span></span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">int</span> line=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">bool</span> full;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;game_win_height<span class="number">-1</span>;i++)&#123;</span><br><span class="line">		full=<span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;game_win_width<span class="number">-1</span>;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(box_map[i][j]==<span class="number">0</span>)</span><br><span class="line">				full=<span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(full)&#123;</span><br><span class="line">			line++;			<span class="comment">// 标记已满的行数</span></span><br><span class="line">			score+=<span class="number">50</span>;		<span class="comment">// 如果当前行已满，则对应的分数+50，并将当前行中的所有元素制0</span></span><br><span class="line">			<span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;game_win_width<span class="number">-1</span>;j++)</span><br><span class="line">				box_map[i][j]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(line!=<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(i=game_win_height<span class="number">-2</span>;i&gt;=<span class="number">2</span>;i--)&#123;		<span class="comment">// 从最底层开始判断</span></span><br><span class="line">			<span class="keyword">int</span> s=i;</span><br><span class="line">			<span class="keyword">if</span>(exsqr(i)==<span class="number">0</span>)&#123;			<span class="comment">// 判断当前行是否是空行</span></span><br><span class="line">				<span class="keyword">while</span>(s&gt;<span class="number">1</span> &amp;&amp; exsqr(--s)==<span class="number">0</span>);		<span class="comment">// 向上寻找，直到出现不是空行的行</span></span><br><span class="line">				<span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;game_win_width<span class="number">-1</span>;j++)&#123;</span><br><span class="line">					box_map[i][j]=box_map[s][j];</span><br><span class="line">					box_map[s][j]=<span class="number">0</span>;				<span class="comment">// 将不是空行的，移动到最下层的空行处，并将移动过之后的位置制0</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;game_win_height<span class="number">-1</span>;i++)			<span class="comment">// 刷新屏幕</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;game_win_width<span class="number">-1</span>;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(box_map[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">				mvwaddch(game_win,i,j,<span class="string">'#'</span>);</span><br><span class="line">				wrefresh(game_win);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				mvwaddch(game_win,i,j,<span class="string">' '</span>);</span><br><span class="line">				wrefresh(game_win);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;			</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Piece::score_next()&#123;</span><br><span class="line">	score+=<span class="number">10</span>;</span><br><span class="line">	judge();</span><br><span class="line"></span><br><span class="line">	mvwprintw(score_win, hint_win_height/<span class="number">2</span>,hint_win_width/<span class="number">2</span><span class="number">-2</span>,<span class="string">"%d"</span>,score);		<span class="comment">// 显示分数</span></span><br><span class="line">	wrefresh(score_win);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	set_shape(next_shape,box_shape,size_w,size_h);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>-&gt;next_shape=getrand(<span class="number">0</span>,<span class="number">6</span>);			<span class="comment">// 显示下一个图形</span></span><br><span class="line">	set_shape(next_shape,next_box_shape,next_size_w,next_size_h);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>;i&lt;hint_win_height<span class="number">-1</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;hint_win_width<span class="number">-1</span>;j++)&#123;</span><br><span class="line">			mvwaddch(hint_win, i, j,<span class="string">' '</span>);</span><br><span class="line">			wrefresh(hint_win);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">			<span class="keyword">if</span>(next_box_shape[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">				mvwaddch(hint_win,(hint_win_height-size_h)/<span class="number">2</span>+i,(hint_win_width-size_w)/<span class="number">2</span>+j,<span class="string">'#'</span>);</span><br><span class="line">				wrefresh(hint_win);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个过程中也学到了c++的一些其他的知识。</p>
<ul>
<li>select函数 用法 c++</li>
</ul>
<blockquote>
<p>select函数用于在非阻塞中，当一个套接字或一组套接字有信号时通知你，系统提供select函数来实现多路复用输入/输出模型，原型：<br>int select(int maxfd,fd_set <em>rdset,fd_set </em>wrset,fd_set <em>exset,struct timeval </em>timeout);<br>所在的头文件为：#include &lt;sys/time.h&gt; 和#include &lt;unistd.h&gt;<br>先对函数中的参数做一个简单的介绍。参数maxfd是需要监视的最大的文件描述符值+1；rdset,wrset,exset分别对应于需要检测的可读文件描述符的集合，可写文件描述符的集 合及异常文件描述符的集合。struct timeval结构用于描述一段时间长度，如果在这个时间内，需要监视的描述符没有事件发生则函数返回，返回值为0。</p>
</blockquote>
<p>作者：shuolol<br>链接：<a href="https://www.jianshu.com/p/b5d7b7c6b9f7" target="_blank" rel="noopener">https://www.jianshu.com/p/b5d7b7c6b9f7</a><br>來源：简书<br>简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。</p>
<ul>
<li>addch(), echochar(), mvaddch(), mvwaddch(), waddch(), wechochar()</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SYNOPSIS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;curses.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addch</span><span class="params">(chtype ch)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">waddch</span><span class="params">(WINDOW *win, chtype ch)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mvaddch</span><span class="params">(<span class="keyword">int</span> y, <span class="keyword">int</span> x, chtype ch)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mvwaddch</span><span class="params">(WINDOW *win, <span class="keyword">int</span> y, <span class="keyword">int</span> x, chtype ch)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">echochar</span><span class="params">(chtype ch)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wechochar</span><span class="params">(WINDOW *win, chtype ch)</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>DESCRIPTION<br>The addch(), waddch(), mvaddch() and mvwaddch() routines put the character ch into the given window at its current window position, which is then advanced. They are analogous to putchar() in stdio(). If the advance is at the right margin, the cursor automatically wraps to the beginning of the next line. At the bottom of the current scrolling region, if scrollok() is enabled, the scrolling region is scrolled up one line.</p>
</blockquote>
<blockquote>
<p>If ch is a tab, newline, or backspace, the cursor is moved appropriately within the window. Backspace moves the cursor one character left; at the left edge of a window it does nothing. Newline does a clrtoeol(), then moves the cursor to the window left margin on the next line, scrolling the window if on the last line). Tabs are considered to be at every eighth column.</p>
</blockquote>
<blockquote>
<p>If ch is any control character other than tab, newline, or backspace, it is drawn in ^X notation. Calling winch() after adding a control character does not return the character itself, but instead returns the ^-representation of the control character. (To emit control characters literally, use echochar().)</p>
</blockquote>
<blockquote>
<p>Video attributes can be combined with a character argument passed to addch() or related functions by logical-ORing them into the character. (Thus, text, including attributes, can be copied from one place to another using inch() and addch().). See the curs_attr() page for values of predefined video attribute constants that can be usefully OR’ed into characters.</p>
</blockquote>
<blockquote>
<p>The echochar() and wechochar() routines are equivalent to a call to addch() followed by a call to refresh(), or a call to waddch() followed by a call to wrefresh(). The knowledge that only a single character is being output is used and, for non-control characters, a considerable performance gain may be seen by using these routines instead of their equivalents.</p>
</blockquote>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/c/" rel="tag"># c++</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/29/using-c-to-realize-2048/" rel="next" title="using c++ to realize 2048">
                <i class="fa fa-chevron-left"></i> using c++ to realize 2048
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/02/Python-image-convert-string/" rel="prev" title="Python image convert string">
                Python image convert string <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://p4wiqzx0i.bkt.clouddn.com/image4.jpg"
                alt="kai" />
            
              <p class="site-author-name" itemprop="name">kai</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/ruruozhenhao" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:ruruozhenhao@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://gitbook.com/learncat" target="_blank" title="Gitbook"><i class="fa fa-fw fa-bookmark"></i>Gitbook</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.cnblogs.com/ruruozhenhao/" target="_blank" title="cnblog"><i class="fa fa-fw fa-globe"></i>cnblog</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kai</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
